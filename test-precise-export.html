<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á≤æÁ°ÆÂØºÂá∫ÊµãËØï</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .test-card {
            width: 350px;
            height: 500px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            position: relative;
            margin: 20px auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }
        
        .test-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }
        
        .avatar {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #fff;
            border: 4px solid #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #667eea;
        }
        
        .name {
            position: absolute;
            top: 150px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }
        
        .title {
            position: absolute;
            top: 180px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.9);
            font-size: 14px;
            text-align: center;
        }
        
        .stats {
            position: absolute;
            top: 220px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 30px;
        }
        
        .stat-item {
            text-align: center;
            color: white;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 10px;
            opacity: 0.8;
        }
        
        .features {
            position: absolute;
            bottom: 80px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-around;
        }
        
        .feature {
            text-align: center;
            color: white;
            font-size: 12px;
        }
        
        .phone {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            color: white;
            font-size: 14px;
        }
        
        .controls {
            text-align: center;
            margin: 20px;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 0 10px;
            font-size: 16px;
        }
        
        button:hover {
            background: #5a6fd8;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>Á≤æÁ°ÆÂØºÂá∫ÂäüËÉΩÊµãËØï</h1>
    
    <div class="controls">
        <button onclick="testPreciseExport('png')" id="pngBtn">ÂØºÂá∫PNG</button>
        <button onclick="testPreciseExport('jpg')" id="jpgBtn">ÂØºÂá∫JPG</button>
    </div>
    
    <div class="test-card" id="testCard">
        <div class="avatar">üë§</div>
        <div class="name">AHMED AL-FAWAZ</div>
        <div class="title">SENIOR LANGUAGE COACH</div>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number">0</div>
                <div class="stat-label">STUDENTS<br>SERVED</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">0%</div>
                <div class="stat-label">POSITIVE<br>RATING</div>
            </div>
        </div>
        <div class="features">
            <div class="feature">Teacher<br>Selection</div>
            <div class="feature">Progress<br>Feedback</div>
            <div class="feature">Study<br>Plan</div>
            <div class="feature">Learning<br>Resources</div>
        </div>
        <div class="phone">ÁîµËØù: 050-XXXX-XXAB</div>
    </div>
    
    <script>
        async function testPreciseExport(format) {
            const pngBtn = document.getElementById('pngBtn');
            const jpgBtn = document.getElementById('jpgBtn');
            
            // Á¶ÅÁî®ÊåâÈíÆ
            pngBtn.disabled = true;
            jpgBtn.disabled = true;
            pngBtn.textContent = 'ÂØºÂá∫‰∏≠...';
            jpgBtn.textContent = 'ÂØºÂá∫‰∏≠...';
            
            try {
                console.log('=== Á≤æÁ°ÆÂØºÂá∫ÊµãËØïÂºÄÂßã ===');
                
                // ÂàõÂª∫È´òÂàÜËæ®ÁéáÂâØÊú¨
                const originalCard = document.getElementById('testCard');
                const clonedCard = originalCard.cloneNode(true);
                
                // ËÆæÁΩÆÂÖãÈöÜÂç°ÁâáÁöÑÊ†∑Âºè
                clonedCard.style.position = 'absolute';
                clonedCard.style.left = '-9999px';
                clonedCard.style.top = '0';
                clonedCard.style.width = '700px';  // 2ÂÄçÂàÜËæ®Áéá
                clonedCard.style.height = '1000px'; // 2ÂÄçÂàÜËæ®Áéá
                clonedCard.style.transform = 'scale(2)';
                clonedCard.style.transformOrigin = 'top left';
                clonedCard.style.borderRadius = '32px';
                clonedCard.style.overflow = 'hidden';
                clonedCard.style.boxShadow = '0 25px 50px -12px rgba(0, 0, 0, 0.25)';
                
                // Ê∑ªÂä†Âà∞DOM
                document.body.appendChild(clonedCard);
                
                // Á≠âÂæÖÊ∏≤ÊüìÂÆåÊàê
                await new Promise(resolve => setTimeout(resolve, 200));
                
                // ‰ΩøÁî®html2canvasÂØºÂá∫
                const canvas = await html2canvas(clonedCard, {
                    backgroundColor: null,
                    useCORS: true,
                    allowTaint: true,
                    scale: 1,
                    width: 700,
                    height: 1000,
                    logging: true,
                    foreignObjectRendering: false,
                    removeContainer: false,
                    imageTimeout: 10000
                });
                
                // Ê∏ÖÁêÜDOM
                document.body.removeChild(clonedCard);
                
                console.log('CanvasÂ∞∫ÂØ∏:', canvas.width, 'x', canvas.height);
                
                // ËΩ¨Êç¢‰∏∫BlobÂπ∂‰∏ãËΩΩ
                canvas.toBlob((blob) => {
                    if (blob) {
                        console.log('BlobÂ§ßÂ∞è:', blob.size, 'bytes');
                        saveAs(blob, `test-card.${format}`);
                        alert('Á≤æÁ°ÆÂØºÂá∫ÊàêÂäüÔºÅ');
                    } else {
                        alert('ÁîüÊàêÊñá‰ª∂Â§±Ë¥•');
                    }
                }, format === 'jpg' ? 'image/jpeg' : 'image/png', format === 'jpg' ? 0.9 : 1);
                
            } catch (error) {
                console.error('Á≤æÁ°ÆÂØºÂá∫Â§±Ë¥•:', error);
                alert('Á≤æÁ°ÆÂØºÂá∫Â§±Ë¥•: ' + error.message);
            } finally {
                // ÊÅ¢Â§çÊåâÈíÆ
                pngBtn.disabled = false;
                jpgBtn.disabled = false;
                pngBtn.textContent = 'ÂØºÂá∫PNG';
                jpgBtn.textContent = 'ÂØºÂá∫JPG';
            }
        }
    </script>
</body>
</html>
