我将为您编写完整的项目文档。以下是所有相关文档：

# 项目需求文档集合

## 1. 产品需求文档 (PRD)

### 1.1 项目概述
**项目名称：** 51Talk员工数字名片制作平台

**项目背景：** 为51Talk内部员工提供统一的数字名片制作工具，提升品牌形象和业务展示效果。

**目标用户：** 51Talk阿里邮箱用户（内部员工）

### 1.2 功能需求

#### 1.2.1 用户端功能
1. **用户认证**
   - 阿里邮箱注册/登录
   - 邮箱验证码验证
 
2. **名片编辑功能**
   - 头像上传及AI抠图
   - 个人信息编辑
   - 模块拖拽布局（管理员解锁后）
   - 实时预览
 
3. **信息管理**
   - 姓名编辑
   - 头衔选择（4个固定选项）
   - 业绩数据录入
   - 联系方式管理
 
4. **导出功能**
   - 名片图片导出
   - 多格式支持

#### 1.2.2 管理端功能
1. **数据统计面板**
   - 用户注册趋势统计
   - 活跃用户数量监控
   - API调用频次统计
   - 名片下载量统计
   - 热门职位头衔分析
   - 系统性能监控
 
2. **布局管理**
   - 名片模块位置锁定/解锁控制
   - 默认名片布局设置
   - 模块显示/隐藏权限管理
   - 拖拽功能开关控制
 
3. **用户管理**
   - 用户列表查看和搜索
   - 用户详细信息管理
   - 用户行为记录查询
   - 用户权限管理
   - 批量用户操作
 
4. **系统管理**
   - 管理员权限分配
   - 系统配置管理
   - 数据备份和恢复
   - 日志管理和查询

### 1.3 技术需求
- Remove.bg API集成
- Supabase数据库
- 响应式设计
- 拖拽交互

---

## 2. 技术架构文档

### 2.1 系统架构图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端应用      │    │   后端API      │    │   数据库层      │
│                 │    │                 │    │                 │
│ - React/Vue     │◄──►│ - Node.js      │◄──►│ - Supabase     │
│ - 拖拽组件      │    │ - Express      │    │ - PostgreSQL   │
│ - 图片处理      │    │ - JWT认证      │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
        │                        │
        │                        │
        ▼                        ▼
┌─────────────────┐    ┌─────────────────┐
│   第三方服务    │    │   邮件服务      │
│                 │    │                 │
│ - Remove.bg API │    │ - 阿里邮箱API   │
│ - 图片CDN       │    │ - 验证码服务    │
└─────────────────┘    └─────────────────┘
```

### 2.2 数据库设计

#### 用户表 (users)
```sql
CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  name VARCHAR(100),
  avatar_url TEXT,
  title ENUM('首席成长伙伴', '金牌成长顾问', '五星服务官', '学习领航官'),
  students_served INTEGER DEFAULT 0,
  rating DECIMAL(3,2) DEFAULT 0,
  phone VARCHAR(20),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

#### 布局配置表 (layout_config)
```sql
CREATE TABLE layout_config (
  id SERIAL PRIMARY KEY,
  module_name VARCHAR(50) NOT NULL,
  x_position INTEGER DEFAULT 0,
  y_position INTEGER DEFAULT 0,
  z_index INTEGER DEFAULT 0,
  is_locked BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW()
);
```

#### 使用统计表 (usage_stats)
```sql
CREATE TABLE usage_stats (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  action_type VARCHAR(50), -- 'api_call', 'download', 'login'
  details JSON,
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

## 3. 前端开发文档

### 3.1 技术栈
- **框架：** React 18 + TypeScript
- **状态管理：** Redux Toolkit
- **UI组件：** Ant Design
- **拖拽：** react-dnd
- **图片处理：** fabric.js
- **HTTP客户端：** axios

### 3.2 项目结构
```
src/
├── components/          # 通用组件
│   ├── DragModule/     # 拖拽模块组件
│   ├── NameCardEditor/ # 名片编辑器
│   └── ImageUpload/    # 图片上传组件
├── pages/              # 页面组件
│   ├── Login/          # 登录页
│   ├── Dashboard/      # 用户面板
│   └── Admin/          # 管理面板
├── hooks/              # 自定义Hook
├── services/           # API服务
├── store/              # Redux store
├── types/              # TypeScript类型
└── utils/              # 工具函数
```

### 3.3 核心组件设计

#### 3.3.1 拖拽模块组件
```typescript
interface DragModuleProps {
  id: string;
  position: { x: number; y: number; z: number };
  isLocked: boolean;
  children: React.ReactNode;
  onPositionChange: (id: string, position: Position) => void;
}

const DragModule: React.FC<DragModuleProps> = ({
  id,
  position,
  isLocked,
  children,
  onPositionChange
}) => {
  // 拖拽逻辑实现
};
```

#### 3.3.2 名片编辑器
```typescript
interface NameCardEditorProps {
  userInfo: UserInfo;
  layoutConfig: LayoutConfig[];
  onSave: (data: UserInfo) => void;
  onExport: () => void;
}

const NameCardEditor: React.FC<NameCardEditorProps> = ({
  userInfo,
  layoutConfig,
  onSave,
  onExport
}) => {
  // 编辑器逻辑实现
};
```

### 3.4 状态管理
```typescript
interface RootState {
  auth: AuthState;
  user: UserState;
  layout: LayoutState;
  stats: StatsState;
}

// 用户状态
interface UserState {
  userInfo: UserInfo;
  loading: boolean;
  error: string | null;
}

// 布局状态
interface LayoutState {
  modules: LayoutModule[];
  isLocked: boolean;
  dragMode: boolean;
}
```

---

## 4. 管理者系统详细设计

### 4.1 管理员权限体系

#### 4.1.1 权限级别定义
```sql
CREATE TABLE admin_roles (
  id SERIAL PRIMARY KEY,
  role_name VARCHAR(50) UNIQUE NOT NULL, -- 'super_admin', 'admin', 'moderator'
  permissions JSON NOT NULL,
  description TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE admin_users (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
  role_id INTEGER REFERENCES admin_roles(id),
  assigned_by INTEGER REFERENCES users(id),
  assigned_at TIMESTAMP DEFAULT NOW(),
  is_active BOOLEAN DEFAULT true
);
```

#### 4.1.2 权限配置示例
```json
{
  "super_admin": {
    "user_management": ["view", "create", "update", "delete"],
    "layout_management": ["view", "update", "lock", "unlock"],
    "system_management": ["view", "update", "backup", "restore"],
    "statistics": ["view", "export"],
    "admin_management": ["view", "create", "update", "delete"]
  },
  "admin": {
    "user_management": ["view", "update"],
    "layout_management": ["view", "update", "lock", "unlock"],
    "statistics": ["view", "export"]
  },
  "moderator": {
    "user_management": ["view"],
    "statistics": ["view"]
  }
}
```

### 4.2 管理面板功能模块

#### 4.2.1 数据统计面板
```typescript
interface DashboardStats {
  userStats: {
    totalUsers: number;
    activeUsers: number;
    newUsersToday: number;
    registrationTrend: ChartData[];
  };
  usageStats: {
    totalDownloads: number;
    downloadsToday: number;
    downloadTrend: ChartData[];
    popularFormats: FormatStats[];
  };
  systemStats: {
    apiCalls: number;
    responseTime: number;
    errorRate: number;
    uptime: string;
  };
  titleStats: {
    titleDistribution: TitleStats[];
    popularTitles: string[];
  };
}

// 统计服务
const statsService = {
  async getDashboardStats(): Promise<DashboardStats> {
    const [userStats, usageStats, systemStats, titleStats] = await Promise.all([
      this.getUserStats(),
      this.getUsageStats(),
      this.getSystemStats(),
      this.getTitleStats()
    ]);
    
    return { userStats, usageStats, systemStats, titleStats };
  }
};
```

#### 4.2.2 用户管理系统
```typescript
interface UserManagement {
  searchUsers(query: SearchQuery): Promise<UserSearchResult>;
  getUserDetails(userId: string): Promise<UserDetails>;
  updateUserInfo(userId: string, data: UserUpdateData): Promise<void>;
  toggleUserStatus(userId: string, status: boolean): Promise<void>;
  exportUserData(format: 'csv' | 'excel'): Promise<Blob>;
  getUserActionHistory(userId: string): Promise<ActionHistory[]>;
}

interface SearchQuery {
  keyword?: string;
  title?: string;
  registrationDate?: DateRange;
  status?: 'active' | 'inactive';
  sortBy?: 'name' | 'registration_date' | 'last_login';
  sortOrder?: 'asc' | 'desc';
  page: number;
  pageSize: number;
}
```

#### 4.2.3 布局管理系统
```typescript
interface LayoutManagement {
  getLayoutConfig(): Promise<LayoutConfig>;
  updateLayoutConfig(config: LayoutConfig): Promise<void>;
  lockModule(moduleId: string): Promise<void>;
  unlockModule(moduleId: string): Promise<void>;
  resetToDefault(): Promise<void>;
  previewLayout(config: LayoutConfig): Promise<string>; // 返回预览图URL
}

interface LayoutConfig {
  modules: LayoutModule[];
  defaultSettings: {
    isDragEnabled: boolean;
    showGrid: boolean;
    snapToGrid: boolean;
  };
}

interface LayoutModule {
  id: string;
  name: string;
  position: { x: number; y: number; z: number };
  size: { width: number; height: number };
  isLocked: boolean;
  isVisible: boolean;
  permissions: {
    canMove: boolean;
    canResize: boolean;
    canEdit: boolean;
  };
}
```

### 4.3 管理面板API设计

#### 4.3.1 统计数据接口
```javascript
// GET /api/admin/stats/dashboard
{
  "userStats": {
    "totalUsers": 1250,
    "activeUsers": 890,
    "newUsersToday": 15,
    "registrationTrend": [
      { "date": "2024-01-01", "count": 45 },
      { "date": "2024-01-02", "count": 52 }
    ]
  },
  "usageStats": {
    "totalDownloads": 5670,
    "downloadsToday": 125,
    "downloadTrend": [
      { "date": "2024-01-01", "count": 234 },
      { "date": "2024-01-02", "count": 278 }
    ],
    "popularFormats": [
      { "format": "png", "count": 3450, "percentage": 60.8 },
      { "format": "jpg", "count": 2220, "percentage": 39.2 }
    ]
  }
}

// GET /api/admin/stats/users?period=7d&groupBy=day
// GET /api/admin/stats/downloads?period=30d&format=png
// GET /api/admin/stats/titles
```

#### 4.3.2 用户管理接口
```javascript
// GET /api/admin/users?search=张三&title=首席成长伙伴&page=1&pageSize=20
{
  "users": [
    {
      "id": "user123",
      "name": "张三",
      "email": "zhang.san@51talk.com",
      "title": "首席成长伙伴",
      "registrationDate": "2024-01-15T10:30:00Z",
      "lastLogin": "2024-01-20T14:25:00Z",
      "status": "active",
      "downloadCount": 15,
      "avatarUrl": "https://..."
    }
  ],
  "pagination": {
    "page": 1,
    "pageSize": 20,
    "total": 125,
    "totalPages": 7
  }
}

// GET /api/admin/users/{userId}/details
// PUT /api/admin/users/{userId}
// DELETE /api/admin/users/{userId}
// GET /api/admin/users/{userId}/actions
// POST /api/admin/users/export
```

#### 4.3.3 布局管理接口
```javascript
// GET /api/admin/layout/config
{
  "modules": [
    {
      "id": "avatar",
      "name": "头像模块",
      "position": { "x": 50, "y": 50, "z": 1 },
      "size": { "width": 100, "height": 100 },
      "isLocked": true,
      "isVisible": true,
      "permissions": {
        "canMove": false,
        "canResize": false,
        "canEdit": true
      }
    }
  ],
  "defaultSettings": {
    "isDragEnabled": false,
    "showGrid": true,
    "snapToGrid": true
  }
}

// PUT /api/admin/layout/config
// POST /api/admin/layout/modules/{moduleId}/lock
// POST /api/admin/layout/modules/{moduleId}/unlock
// POST /api/admin/layout/reset
```

### 4.4 管理面板前端组件

#### 4.4.1 统计面板组件
```typescript
// AdminDashboard.tsx
const AdminDashboard: React.FC = () => {
  const [stats, setStats] = useState<DashboardStats | null>(null);
  const [loading, setLoading] = useState(true);
  const [dateRange, setDateRange] = useState<DateRange>({ 
    start: dayjs().subtract(7, 'day'), 
    end: dayjs() 
  });

  useEffect(() => {
    loadDashboardStats();
  }, [dateRange]);

  return (
    <div className="admin-dashboard">
      <Row gutter={[16, 16]}>
        <Col span={6}>
          <StatCard 
            title="总用户数" 
            value={stats?.userStats.totalUsers} 
            trend={stats?.userStats.registrationTrend}
          />
        </Col>
        <Col span={6}>
          <StatCard 
            title="活跃用户" 
            value={stats?.userStats.activeUsers} 
          />
        </Col>
        <Col span={6}>
          <StatCard 
            title="今日下载" 
            value={stats?.usageStats.downloadsToday} 
          />
        </Col>
        <Col span={6}>
          <StatCard 
            title="总下载量" 
            value={stats?.usageStats.totalDownloads} 
          />
        </Col>
      </Row>
      
      <Row gutter={[16, 16]} style={{ marginTop: 16 }}>
        <Col span={12}>
          <Card title="用户注册趋势">
            <LineChart data={stats?.userStats.registrationTrend} />
          </Card>
        </Col>
        <Col span={12}>
          <Card title="下载量趋势">
            <LineChart data={stats?.usageStats.downloadTrend} />
          </Card>
        </Col>
      </Row>
    </div>
  );
};
```

#### 4.4.2 用户管理组件
```typescript
// UserManagement.tsx
const UserManagement: React.FC = () => {
  const [users, setUsers] = useState<User[]>([]);
  const [searchForm] = Form.useForm();
  const [pagination, setPagination] = useState({ page: 1, pageSize: 20 });

  const columns = [
    {
      title: '头像',
      dataIndex: 'avatarUrl',
      render: (url: string) => <Avatar src={url} />
    },
    {
      title: '姓名',
      dataIndex: 'name',
      sorter: true
    },
    {
      title: '邮箱',
      dataIndex: 'email'
    },
    {
      title: '职位',
      dataIndex: 'title',
      filters: [
        { text: '首席成长伙伴', value: '首席成长伙伴' },
        { text: '金牌成长顾问', value: '金牌成长顾问' },
        { text: '五星服务官', value: '五星服务官' },
        { text: '学习领航官', value: '学习领航官' }
      ]
    },
    {
      title: '注册时间',
      dataIndex: 'registrationDate',
      render: (date: string) => dayjs(date).format('YYYY-MM-DD HH:mm')
    },
    {
      title: '下载次数',
      dataIndex: 'downloadCount'
    },
    {
      title: '状态',
      dataIndex: 'status',
      render: (status: string) => (
        <Tag color={status === 'active' ? 'green' : 'red'}>
          {status === 'active' ? '活跃' : '非活跃'}
        </Tag>
      )
    },
    {
      title: '操作',
      render: (record: User) => (
        <Space>
          <Button size="small" onClick={() => viewUserDetails(record.id)}>
            查看
          </Button>
          <Button size="small" onClick={() => editUser(record.id)}>
            编辑
          </Button>
          <Button 
            size="small" 
            danger 
            onClick={() => toggleUserStatus(record.id)}
          >
            {record.status === 'active' ? '禁用' : '启用'}
          </Button>
        </Space>
      )
    }
  ];

  return (
    <div className="user-management">
      <Card>
        <Form 
          form={searchForm} 
          layout="inline" 
          onFinish={handleSearch}
          style={{ marginBottom: 16 }}
        >
          <Form.Item name="keyword">
            <Input placeholder="搜索姓名或邮箱" />
          </Form.Item>
          <Form.Item name="title">
            <Select placeholder="选择职位" allowClear>
              <Option value="首席成长伙伴">首席成长伙伴</Option>
              <Option value="金牌成长顾问">金牌成长顾问</Option>
              <Option value="五星服务官">五星服务官</Option>
              <Option value="学习领航官">学习领航官</Option>
            </Select>
          </Form.Item>
          <Form.Item name="dateRange">
            <RangePicker />
          </Form.Item>
          <Form.Item>
            <Button type="primary" htmlType="submit">
              搜索
            </Button>
          </Form.Item>
          <Form.Item>
            <Button onClick={exportUsers}>
              导出
            </Button>
          </Form.Item>
        </Form>
        
        <Table 
          columns={columns}
          dataSource={users}
          pagination={{
            ...pagination,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total) => `共 ${total} 条记录`
          }}
          onChange={handleTableChange}
        />
      </Card>
    </div>
  );
};
```

#### 4.4.3 布局管理组件
```typescript
// LayoutManagement.tsx
const LayoutManagement: React.FC = () => {
  const [layoutConfig, setLayoutConfig] = useState<LayoutConfig | null>(null);
  const [previewMode, setPreviewMode] = useState(false);

  const handleModuleUpdate = (moduleId: string, updates: Partial<LayoutModule>) => {
    setLayoutConfig(prev => ({
      ...prev!,
      modules: prev!.modules.map(module => 
        module.id === moduleId ? { ...module, ...updates } : module
      )
    }));
  };

  const saveLayout = async () => {
    try {
      await adminAPI.updateLayoutConfig(layoutConfig!);
      message.success('布局配置已保存');
    } catch (error) {
      message.error('保存失败');
    }
  };

  return (
    <div className="layout-management">
      <Card 
        title="名片布局管理"
        extra={
          <Space>
            <Switch 
              checked={previewMode}
              onChange={setPreviewMode}
              checkedChildren="预览模式"
              unCheckedChildren="编辑模式"
            />
            <Button type="primary" onClick={saveLayout}>
              保存配置
            </Button>
            <Button onClick={resetToDefault}>
              重置为默认
            </Button>
          </Space>
        }
      >
        <Row gutter={16}>
          <Col span={16}>
            <div className="layout-canvas">
              {layoutConfig?.modules.map(module => (
                <DraggableModule
                  key={module.id}
                  module={module}
                  onUpdate={(updates) => handleModuleUpdate(module.id, updates)}
                  disabled={previewMode}
                />
              ))}
            </div>
          </Col>
          <Col span={8}>
            <Card title="模块设置" size="small">
              {layoutConfig?.modules.map(module => (
                <ModuleSettings
                  key={module.id}
                  module={module}
                  onUpdate={(updates) => handleModuleUpdate(module.id, updates)}
                />
              ))}
            </Card>
          </Col>
        </Row>
      </Card>
    </div>
  );
};
```

---

## 5. 后端开发文档

### 4.1 技术栈
- **运行时：** Node.js 18+
- **框架：** Express.js
- **数据库：** Supabase (PostgreSQL)
- **认证：** JWT
- **图片处理：** Remove.bg API
- **邮件服务：** 阿里邮箱API

### 4.2 项目结构
```
src/
├── controllers/        # 控制器
│   ├── auth.js        # 认证控制器
│   ├── user.js        # 用户控制器
│   ├── layout.js      # 布局控制器
│   └── stats.js       # 统计控制器
├── middleware/         # 中间件
│   ├── auth.js        # 认证中间件
│   ├── validation.js  # 验证中间件
│   └── upload.js      # 文件上传中间件
├── routes/            # 路由
├── services/          # 服务层
│   ├── emailService.js
│   ├── imageService.js
│   └── supabaseService.js
├── utils/             # 工具函数
└── config/            # 配置文件
```

### 4.3 API接口设计

#### 4.3.1 认证接口
```javascript
// POST /api/auth/register
{
  "email": "user@51talk.com",
  "name": "张三"
}

// POST /api/auth/verify
{
  "email": "user@51talk.com",
  "code": "123456"
}

// POST /api/auth/login
{
  "email": "user@51talk.com",
  "password": "optional"
}
```

#### 4.3.2 用户信息接口
```javascript
// GET /api/user/profile
// PUT /api/user/profile
{
  "name": "张三",
  "title": "首席成长伙伴",
  "studentsServed": 1000,
  "rating": 4.95,
  "phone": "13800138000"
}

// POST /api/user/avatar
// FormData with image file
```

#### 4.3.3 布局管理接口
```javascript
// GET /api/layout/config
// PUT /api/layout/config (Admin only)
{
  "modules": [
    {
      "id": "avatar",
      "position": { "x": 50, "y": 50, "z": 1 },
      "isLocked": true
    }
  ]
}
```

### 4.4 核心服务实现

#### 4.4.1 图片抠图服务
```javascript
const imageService = {
  async removeBackground(imageFile) {
    const formData = new FormData();
    formData.append('image_file', imageFile);
  
    const response = await axios.post('https://api.remove.bg/v1.0/removebg', formData, {
      headers: {
        'X-Api-Key': process.env.REMOVE_BG_API_KEY,
      },
      responseType: 'arraybuffer'
    });
  
    return response.data;
  }
};
```

#### 4.4.2 邮件验证服务
```javascript
const emailService = {
  async sendVerificationCode(email) {
    const code = Math.random().toString().slice(2, 8);
  
    // 发送邮件逻辑
    await this.sendEmail(email, '验证码', `您的验证码是：${code}`);
  
    // 存储验证码（Redis或内存）
    await this.storeCode(email, code);
  
    return true;
  }
};
```

---

## 5. 数据库设计文档

### 5.1 Supabase配置

#### 5.1.1 环境变量
```env
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_KEY=your_supabase_service_key
```

#### 5.1.2 表结构详细设计

**用户表扩展**
```sql
-- 添加索引
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_created_at ON users(created_at);

-- 添加约束
ALTER TABLE users ADD CONSTRAINT check_rating 
CHECK (rating >= 0 AND rating <= 5);

-- 添加触发器更新时间
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_users_updated_at 
BEFORE UPDATE ON users 
FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

**业务能力表**
```sql
CREATE TABLE user_abilities (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
  ability_type VARCHAR(50) NOT NULL, -- 'teacher_screening', 'feedback', 'planning', 'resource_sharing'
  description TEXT,
  is_enabled BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### 5.2 数据访问层
```javascript
const supabaseService = {
  async getUserById(id) {
    const { data, error } = await supabase
      .from('users')
      .select('*')
      .eq('id', id)
      .single();
    
    if (error) throw error;
    return data;
  },

  async updateUserProfile(id, profileData) {
    const { data, error } = await supabase
      .from('users')
      .update(profileData)
      .eq('id', id)
      .select();
    
    if (error) throw error;
    return data[0];
  },

  async logUserAction(userId, actionType, details) {
    const { error } = await supabase
      .from('usage_stats')
      .insert({
        user_id: userId,
        action_type: actionType,
        details: details
      });
    
    if (error) throw error;
  }
};
```

---

## 6. 部署和运维文档

### 6.1 部署架构
```yaml
# docker-compose.yml
version: '3.8'
services:
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      - REACT_APP_API_URL=http://localhost:5000
    
  backend:
    build: ./backend
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=production
      - SUPABASE_URL=${SUPABASE_URL}
      - REMOVE_BG_API_KEY=${REMOVE_BG_API_KEY}
    depends_on:
      - redis
    
  redis:
    image: redis:alpine
    ports:
      - "6379:6379"
```

### 6.2 环境配置
```env
# 生产环境配置
NODE_ENV=production
PORT=5000

# 数据库配置
SUPABASE_URL=your_production_supabase_url
SUPABASE_ANON_KEY=your_production_anon_key
SUPABASE_SERVICE_KEY=your_production_service_key

# 第三方服务
REMOVE_BG_API_KEY=your_remove_bg_api_key
ALI_EMAIL_API_KEY=your_ali_email_api_key

# JWT配置
JWT_SECRET=your_jwt_secret
JWT_EXPIRE=7d

# Redis配置
REDIS_URL=redis://localhost:6379
```

### 6.3 监控和日志
```javascript
// 日志配置
const winston = require('winston');

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});
```

---

## 7. 测试文档

### 7.1 测试策略
- **单元测试：** Jest + React Testing Library
- **集成测试：** Supertest
- **E2E测试：** Cypress
- **API测试：** Postman/Newman

### 7.2 测试用例示例
```javascript
// 用户注册测试
describe('User Registration', () => {
  test('should register user with valid 51talk email', async () => {
    const userData = {
      email: 'test@51talk.com',
      name: '测试用户'
    };
  
    const response = await request(app)
      .post('/api/auth/register')
      .send(userData)
      .expect(200);
    
    expect(response.body.success).toBe(true);
  });

  test('should reject non-51talk email', async () => {
    const userData = {
      email: 'test@gmail.com',
      name: '测试用户'
    };
  
    await request(app)
      .post('/api/auth/register')
      .send(userData)
      .expect(400);
  });
});
```

---

这套完整的文档涵盖了您的名片项目的所有关键方面。每个文档都可以作为独立的指导文件，同时它们之间又相互关联，形成了完整的项目开发指南。您可以根据实际开发进度和需求对这些文档进行调整和完善。