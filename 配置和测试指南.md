# 51Talk 名片平台 - 配置和测试指南

## 🚀 快速开始

### 1. 环境配置

#### 创建 .env.local 文件
在项目根目录创建 `.env.local` 文件：

```bash
# Supabase 配置
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# 阿里邮箱 SMTP 配置
SMTP_HOST=smtp.qiye.aliyun.com
SMTP_PORT=465
SMTP_USER=your_email@yourdomain.com
SMTP_PASS=your_email_password
SMTP_FROM=51Talk 名片平台 <your_email@yourdomain.com>

# JWT 密钥
JWT_SECRET=your_jwt_secret_key_here

# 应用配置
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### 2. Supabase 数据库配置

#### 步骤 1: 创建 Supabase 项目
1. 访问 [Supabase](https://supabase.com)
2. 创建新项目
3. 等待项目初始化完成

#### 步骤 2: 获取 API 密钥
1. 进入项目设置 → API
2. 复制以下信息：
   - Project URL
   - anon public key
   - service_role secret key

#### 步骤 3: 初始化数据库
1. 进入 Supabase SQL Editor
2. 复制 `database-init.sql` 文件内容
3. 执行 SQL 脚本
4. 确认所有表创建成功

### 3. 阿里邮箱配置

#### 企业邮箱配置
```bash
SMTP_HOST=smtp.qiye.aliyun.com
SMTP_PORT=465
SMTP_USER=your_email@company.com
SMTP_PASS=your_app_password
```

#### 个人邮箱配置
```bash
SMTP_HOST=smtp.aliyun.com
SMTP_PORT=465
SMTP_USER=your_email@aliyun.com
SMTP_PASS=your_app_password
```

#### 获取应用密码
1. 登录阿里邮箱
2. 进入设置 → 安全设置
3. 开启 SMTP 服务
4. 生成应用密码
5. 使用应用密码作为 SMTP_PASS

### 4. 测试配置

#### 测试邮箱发送
```bash
# 安装依赖
npm install dotenv nodemailer

# 运行测试脚本
node test-email.js
```

#### 测试数据库连接
1. 启动开发服务器：`npm run dev`
2. 访问注册页面
3. 尝试注册新用户
4. 检查控制台日志

### 5. 功能测试

#### 注册流程测试
1. 访问 http://localhost:3000/register
2. 输入邮箱、姓名、密码
3. 点击"发送验证码"
4. 检查邮箱是否收到验证码
5. 输入验证码完成注册

#### 编辑器功能测试
1. 登录后进入编辑器
2. 测试文字模块编辑
3. 测试拖拽功能
4. 测试样式调整
5. 测试能力标签显示

## 🔧 故障排除

### 常见问题

#### 1. Supabase 连接超时
**错误信息**: `ConnectTimeoutError: Connect Timeout Error`

**解决方案**:
- 检查网络连接
- 确认 Supabase URL 正确
- 尝试使用 VPN

#### 2. 邮箱发送失败
**错误信息**: `邮件发送失败`

**解决方案**:
- 检查 SMTP 配置
- 确认邮箱密码正确
- 检查防火墙设置

#### 3. 验证码验证失败
**错误信息**: `验证码验证失败`

**解决方案**:
- 检查数据库连接
- 确认验证码表存在
- 检查时间同步

### 调试技巧

#### 1. 查看控制台日志
```bash
# 启动开发服务器
npm run dev

# 查看详细日志
npm run dev -- --verbose
```

#### 2. 检查环境变量
```bash
# 在代码中添加调试信息
console.log('SMTP_HOST:', process.env.SMTP_HOST);
console.log('SUPABASE_URL:', process.env.NEXT_PUBLIC_SUPABASE_URL);
```

#### 3. 测试数据库连接
```javascript
// 在 API 路由中添加测试代码
const supabase = createAdminClient();
const { data, error } = await supabase.from('users').select('count');
console.log('Database test:', { data, error });
```

## 📋 检查清单

### 环境配置
- [ ] 创建 .env.local 文件
- [ ] 配置 Supabase 环境变量
- [ ] 配置阿里邮箱 SMTP
- [ ] 设置 JWT 密钥

### 数据库配置
- [ ] 创建 Supabase 项目
- [ ] 执行数据库初始化脚本
- [ ] 验证表结构正确
- [ ] 测试数据库连接

### 邮箱配置
- [ ] 配置 SMTP 参数
- [ ] 获取应用密码
- [ ] 运行邮箱测试脚本
- [ ] 验证邮件发送成功

### 功能测试
- [ ] 测试用户注册
- [ ] 测试验证码发送
- [ ] 测试验证码验证
- [ ] 测试编辑器功能
- [ ] 测试拖拽功能

## 🎯 下一步

配置完成后，您可以：

1. **开始使用编辑器**：创建和编辑名片
2. **自定义样式**：调整字体、颜色、位置
3. **导出名片**：生成高质量的名片图片
4. **管理用户**：查看用户统计和管理

## 📞 技术支持

如果遇到问题，请检查：

1. 控制台错误日志
2. 网络连接状态
3. 环境变量配置
4. 数据库表结构

---

**注意**: 请确保在生产环境中使用强密码和安全的 JWT 密钥。
