<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°å¯¼å‡ºç³»ç»Ÿæµ‹è¯• - æ— å˜å½¢å¯¼å‡º</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .preview-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .card-container {
            position: relative;
            width: 350px;
            height: 500px;
            margin: 0 auto;
            border: 2px solid #ddd;
            border-radius: 16px;
            overflow: hidden;
            background-image: url('ditu.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .avatar {
            position: absolute;
            left: 127px; /* 175 - 48 */
            top: 64px;
            width: 96px;
            height: 96px;
            border-radius: 50%;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }
        
        .name {
            position: absolute;
            left: 50%;
            top: 176px;
            transform: translateX(-50%);
            font-size: 20px;
            color: #000000;
            font-weight: bold;
            text-align: center;
        }
        
        .title {
            position: absolute;
            left: 50%;
            top: 200px;
            transform: translateX(-50%);
            font-size: 14px;
            color: #666666;
            text-align: center;
        }
        
        .stats {
            position: absolute;
            left: 50%;
            top: 288px;
            transform: translateX(-50%);
            display: flex;
            gap: 64px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 16px;
            color: #000000;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 6px;
            color: #000000;
            line-height: 1;
            margin-top: 2px;
        }
        
        .abilities {
            position: absolute;
            left: 50%;
            top: 380px;
            transform: translateX(-50%);
            width: 260px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px 64px;
        }
        
        .ability-item {
            text-align: center;
            font-size: 8px;
            color: #666666;
            line-height: 1.2;
        }
        
        .phone {
            position: absolute;
            left: 50%;
            top: 472px;
            transform: translateX(-50%);
            font-size: 14px;
            color: #000000;
            font-weight: bold;
            text-align: center;
        }
        
        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-png {
            background: #3b82f6;
            color: white;
        }
        
        .btn-png:hover {
            background: #2563eb;
        }
        
        .btn-jpg {
            background: #10b981;
            color: white;
        }
        
        .btn-jpg:hover {
            background: #059669;
        }
        
        .btn-hd {
            background: #8b5cf6;
            color: white;
        }
        
        .btn-hd:hover {
            background: #7c3aed;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .status.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        
        .status.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .status.loading {
            background: #dbeafe;
            color: #1d4ed8;
            border: 1px solid #bfdbfe;
        }
        
        .hidden {
            display: none;
        }
        
        .canvas-container {
            margin-top: 20px;
            text-align: center;
        }
        
        #exportCanvas {
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .features {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 30px;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .feature-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
        }
        
        .feature-icon {
            color: #10b981;
            font-size: 20px;
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¨ æ–°å¯¼å‡ºç³»ç»Ÿæµ‹è¯•</h1>
            <p>ä½¿ç”¨CanvasåŸç”ŸAPIç»˜åˆ¶ï¼Œå½»åº•è§£å†³å¤´åƒå˜å½¢å’Œæ–‡å­—ä½ç½®åç§»é—®é¢˜</p>
        </div>
        
        <div class="test-grid">
            <!-- é¢„è§ˆåŒºåŸŸ -->
            <div class="preview-section">
                <h2>ğŸ“± åç‰‡é¢„è§ˆ</h2>
                <p>ç²¾ç¡®åƒç´ çº§å¸ƒå±€ï¼Œä¸å¯¼å‡ºç»“æœå®Œå…¨ä¸€è‡´</p>
                
                <div class="card-container">
                    <!-- å¤´åƒ -->
                    <div class="avatar">
                        <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face" 
                             alt="Avatar" id="avatarImg">
                    </div>
                    
                    <!-- å§“å -->
                    <div class="name" id="userName">
                        munihoang99@gmail.com
                    </div>
                    
                    <!-- èŒä½ -->
                    <div class="title" id="userTitle">
                        SENIOR LANGUAGE COACH
                    </div>
                    
                    <!-- ç»Ÿè®¡æ•°æ® -->
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-value" id="studentsCount">5K+</div>
                            <div class="stat-label">STUDENTS<br>SERVED</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="rating">99%</div>
                            <div class="stat-label">POSITIVE<br>RATING</div>
                        </div>
                    </div>
                    
                    <!-- ä¸šåŠ¡èƒ½åŠ› -->
                    <div class="abilities">
                        <div class="ability-item">Teacher<br>Selection</div>
                        <div class="ability-item">Progress<br>Feedback</div>
                        <div class="ability-item">Study<br>Plan</div>
                        <div class="ability-item">Learning<br>Resources</div>
                    </div>
                    
                    <!-- è”ç³»æ–¹å¼ -->
                    <div class="phone" id="userPhone">
                        ç”µè¯: 050-XXXX-XXAB
                    </div>
                </div>
            </div>
            
            <!-- æ§åˆ¶åŒºåŸŸ -->
            <div class="controls">
                <h2>âš™ï¸ å¯¼å‡ºæ§åˆ¶</h2>
                
                <!-- çŠ¶æ€æ˜¾ç¤º -->
                <div id="statusMessage" class="status hidden">
                    å‡†å¤‡å°±ç»ª
                </div>
                
                <!-- å¯¼å‡ºæŒ‰é’® -->
                <div class="button-group">
                    <button class="btn-png" onclick="exportCard('png')" id="btnPng">
                        ğŸ“· å¯¼å‡ºPNG (é«˜è´¨é‡)
                    </button>
                    <button class="btn-jpg" onclick="exportCard('jpg')" id="btnJpg">
                        ğŸ–¼ï¸ å¯¼å‡ºJPG (å°æ–‡ä»¶)
                    </button>
                    <button class="btn-hd" onclick="exportCard('png', 3)" id="btnHd">
                        âœ¨ è¶…é«˜æ¸…PNG (3å€)
                    </button>
                </div>
                
                <!-- æµ‹è¯•å¤´åƒæŒ‰é’® -->
                <div class="button-group">
                    <button onclick="changeAvatar('square')" style="background: #f59e0b; color: white;">
                        ğŸ”³ æ–¹å½¢å¤´åƒæµ‹è¯•
                    </button>
                    <button onclick="changeAvatar('wide')" style="background: #ef4444; color: white;">
                        ğŸ“ å®½å±å¤´åƒæµ‹è¯•
                    </button>
                    <button onclick="changeAvatar('tall')" style="background: #8b5cf6; color: white;">
                        ğŸ“ é«˜å±å¤´åƒæµ‹è¯•
                    </button>
                </div>
                
                <!-- Canvasæ˜¾ç¤ºåŒºåŸŸ -->
                <div class="canvas-container">
                    <canvas id="exportCanvas" style="display: none;"></canvas>
                </div>
            </div>
        </div>
        
        <!-- åŠŸèƒ½ç‰¹æ€§ -->
        <div class="features">
            <h2>ğŸš€ æ–°å¯¼å‡ºç³»ç»Ÿç‰¹æ€§</h2>
            <div class="feature-list">
                <div class="feature-item">
                    <div class="feature-icon">âœ…</div>
                    <div>
                        <strong>é›¶å˜å½¢å¯¼å‡º</strong><br>
                        ä½¿ç”¨CanvasåŸç”ŸAPIç»˜åˆ¶ï¼Œå¤´åƒä¿æŒåŸå§‹æ¯”ä¾‹ï¼Œç»ä¸æ‹‰ä¼¸å˜å½¢
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ¯</div>
                    <div>
                        <strong>ç²¾ç¡®ä½ç½®æ§åˆ¶</strong><br>
                        åƒç´ çº§ç²¾ç¡®å®šä½ï¼Œæ–‡å­—ä½ç½®ä¸é¢„è§ˆå®Œå…¨ä¸€è‡´
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ”</div>
                    <div>
                        <strong>é«˜è´¨é‡æ¸²æŸ“</strong><br>
                        æ”¯æŒ2å€ã€3å€é«˜åˆ†è¾¨ç‡å¯¼å‡ºï¼Œé€‚åˆå°åˆ·å’Œé«˜æ¸…æ˜¾ç¤º
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">âš¡</div>
                    <div>
                        <strong>æ€§èƒ½ä¼˜åŒ–</strong><br>
                        ç›´æ¥Canvasæ¸²æŸ“ï¼Œæ¯”html2canvaså¿«3-5å€ï¼Œå†…å­˜å ç”¨æ›´å°‘
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ¨</div>
                    <div>
                        <strong>å¤šæ ¼å¼æ”¯æŒ</strong><br>
                        PNGé«˜è´¨é‡ã€JPGå°æ–‡ä»¶ï¼Œè´¨é‡å‚æ•°å¯è°ƒèŠ‚
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ›¡ï¸</div>
                    <div>
                        <strong>è·¨åŸŸå…¼å®¹</strong><br>
                        å®Œç¾å¤„ç†è·¨åŸŸå›¾ç‰‡ï¼Œæ”¯æŒCORSå’ŒåŒ¿ååŠ è½½
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
        const userData = {
            name: 'munihoang99@gmail.com',
            title: 'SENIOR LANGUAGE COACH',
            studentsServed: 5000,
            rating: 99,
            phone: '050-XXXX-XXAB',
            avatar_url: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face'
        };

        // æ–‡å­—æ ·å¼é…ç½®
        const textStyles = {
            name: { fontSize: 20, color: '#000000', fontWeight: 'bold' },
            title: { fontSize: 14, color: '#666666', fontWeight: 'normal' },
            studentsServed: { fontSize: 16, color: '#000000', fontWeight: 'bold' },
            positiveRating: { fontSize: 16, color: '#000000', fontWeight: 'bold' },
            phone: { fontSize: 14, color: '#000000', fontWeight: 'bold' }
        };

        // çŠ¶æ€ç®¡ç†
        let isExporting = false;

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type = 'loading') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.classList.remove('hidden');
        }

        // éšè—çŠ¶æ€æ¶ˆæ¯
        function hideStatus() {
            document.getElementById('statusMessage').classList.add('hidden');
        }

        // è®¾ç½®æŒ‰é’®çŠ¶æ€
        function setButtonsDisabled(disabled) {
            ['btnPng', 'btnJpg', 'btnHd'].forEach(id => {
                document.getElementById(id).disabled = disabled;
            });
        }

        // åŠ è½½å›¾ç‰‡
        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => resolve(img);
                img.onerror = () => reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));
                img.src = src;
            });
        }

        // ç»˜åˆ¶åœ†å½¢å¤´åƒ
        async function drawAvatar(ctx, avatarUrl, x, y, size, scale) {
            const img = await loadImage(avatarUrl);
            
            const actualX = x * scale;
            const actualY = y * scale;
            const actualSize = size * scale;
            const radius = actualSize / 2;
            const centerX = actualX + radius;
            const centerY = actualY + radius;

            ctx.save();

            // åˆ›å»ºåœ†å½¢è£å‰ªè·¯å¾„
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.clip();

            // è®¡ç®—å›¾ç‰‡ç»˜åˆ¶å‚æ•°ä»¥ä¿æŒæ¯”ä¾‹
            const aspectRatio = img.width / img.height;
            let drawWidth = actualSize;
            let drawHeight = actualSize;
            let drawX = actualX;
            let drawY = actualY;

            if (aspectRatio > 1) {
                // å®½å›¾ç‰‡ï¼Œä»¥é«˜åº¦ä¸ºå‡†
                drawWidth = actualSize * aspectRatio;
                drawX = actualX - (drawWidth - actualSize) / 2;
            } else {
                // é«˜å›¾ç‰‡ï¼Œä»¥å®½åº¦ä¸ºå‡†
                drawHeight = actualSize / aspectRatio;
                drawY = actualY - (drawHeight - actualSize) / 2;
            }

            // ç»˜åˆ¶å¤´åƒ
            ctx.drawImage(img, drawX, drawY, drawWidth, drawHeight);
            ctx.restore();

            // ç»˜åˆ¶ç™½è‰²è¾¹æ¡†
            ctx.save();
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 4 * scale;
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.stroke();
            ctx.restore();
        }

        // ç»˜åˆ¶èƒŒæ™¯å›¾
        async function drawBackground(ctx, backgroundUrl, width, height) {
            const img = await loadImage(backgroundUrl);
            
            const aspectRatio = img.width / img.height;
            const canvasAspectRatio = width / height;
            
            let drawWidth = width;
            let drawHeight = height;
            let drawX = 0;
            let drawY = 0;

            if (aspectRatio > canvasAspectRatio) {
                drawWidth = height * aspectRatio;
                drawX = -(drawWidth - width) / 2;
            } else {
                drawHeight = width / aspectRatio;
                drawY = -(drawHeight - height) / 2;
            }

            ctx.drawImage(img, drawX, drawY, drawWidth, drawHeight);
        }

        // ç»˜åˆ¶æ–‡å­—
        function drawText(ctx, text, x, y, style, scale, align = 'center') {
            ctx.save();
            
            const fontSize = style.fontSize * scale;
            ctx.font = `${style.fontWeight} ${fontSize}px Arial, sans-serif`;
            ctx.fillStyle = style.color;
            ctx.textAlign = align;
            ctx.textBaseline = 'middle';

            // æ–‡å­—é˜´å½±
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.shadowBlur = 1 * scale;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 1 * scale;

            ctx.fillText(text, x * scale, y * scale);
            ctx.restore();
        }

        // ç»˜åˆ¶å¤šè¡Œæ–‡å­—
        function drawMultilineText(ctx, text, x, y, style, scale, lineHeight = 1.2) {
            const lines = text.split('\n');
            const actualLineHeight = style.fontSize * scale * lineHeight;
            
            lines.forEach((line, index) => {
                const lineY = y + (index * actualLineHeight / scale);
                drawText(ctx, line, x, lineY, style, scale);
            });
        }

        // ä¸»å¯¼å‡ºå‡½æ•°
        async function exportCard(format = 'png', scale = 2) {
            if (isExporting) return;
            
            isExporting = true;
            setButtonsDisabled(true);
            showStatus('æ­£åœ¨ç”Ÿæˆé«˜è´¨é‡å›¾ç‰‡...', 'loading');

            try {
                const canvas = document.getElementById('exportCanvas');
                const ctx = canvas.getContext('2d');
                
                const width = 350;
                const height = 500;
                
                // è®¾ç½®Canvaså°ºå¯¸
                canvas.width = width * scale;
                canvas.height = height * scale;
                canvas.style.width = `${width}px`;
                canvas.style.height = `${height}px`;
                canvas.style.display = 'block';

                // æ¸…ç©ºå¹¶è®¾ç½®èƒŒæ™¯
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // è®¾ç½®é«˜è´¨é‡æ¸²æŸ“
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';

                // 1. ç»˜åˆ¶èƒŒæ™¯å›¾
                await drawBackground(ctx, 'ditu.png', canvas.width, canvas.height);

                // 2. ç»˜åˆ¶å¤´åƒ
                if (userData.avatar_url) {
                    await drawAvatar(ctx, userData.avatar_url, 127, 64, 96, scale);
                }

                // 3. ç»˜åˆ¶æ–‡å­—å†…å®¹
                drawText(ctx, userData.name, 175, 176, textStyles.name, scale);
                drawText(ctx, userData.title, 175, 200, textStyles.title, scale);

                // 4. ç»˜åˆ¶ç»Ÿè®¡æ•°æ®
                const studentsText = userData.studentsServed >= 1000 
                    ? `${Math.floor(userData.studentsServed / 1000)}K+`
                    : userData.studentsServed.toString();
                
                drawText(ctx, studentsText, 143, 288, textStyles.studentsServed, scale);
                drawMultilineText(ctx, 'STUDENTS\nSERVED', 143, 305, 
                    { fontSize: 6, color: '#000000', fontWeight: 'normal' }, scale, 1.0);

                drawText(ctx, `${userData.rating}%`, 207, 288, textStyles.positiveRating, scale);
                drawMultilineText(ctx, 'POSITIVE\nRATING', 207, 305, 
                    { fontSize: 6, color: '#000000', fontWeight: 'normal' }, scale, 1.0);

                // 5. ç»˜åˆ¶ä¸šåŠ¡èƒ½åŠ›æ ‡ç­¾
                const abilities = [
                    { text: 'Teacher\nSelection', x: 110, y: 380 },
                    { text: 'Progress\nFeedback', x: 240, y: 380 },
                    { text: 'Study\nPlan', x: 110, y: 420 },
                    { text: 'Learning\nResources', x: 240, y: 420 }
                ];

                abilities.forEach(ability => {
                    drawMultilineText(ctx, ability.text, ability.x, ability.y, 
                        { fontSize: 8, color: '#666666', fontWeight: 'normal' }, scale, 1.2);
                });

                // 6. ç»˜åˆ¶è”ç³»æ–¹å¼
                drawText(ctx, `ç”µè¯: ${userData.phone}`, 175, 472, textStyles.phone, scale);

                // 7. å¯¼å‡ºå›¾ç‰‡
                showStatus('æ­£åœ¨ç”Ÿæˆæ–‡ä»¶...', 'loading');
                
                const blob = await new Promise(resolve => {
                    if (format === 'jpg') {
                        canvas.toBlob(resolve, 'image/jpeg', 0.95);
                    } else {
                        canvas.toBlob(resolve, 'image/png');
                    }
                });

                // ä¸‹è½½æ–‡ä»¶
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${userData.name}-åç‰‡-æ–°å¯¼å‡º.${format}`;
                a.click();
                URL.revokeObjectURL(url);

                showStatus(`${format.toUpperCase()}å¯¼å‡ºæˆåŠŸï¼`, 'success');
                setTimeout(hideStatus, 3000);

            } catch (error) {
                console.error('å¯¼å‡ºå¤±è´¥:', error);
                showStatus(`å¯¼å‡ºå¤±è´¥: ${error.message}`, 'error');
                setTimeout(hideStatus, 5000);
            } finally {
                isExporting = false;
                setButtonsDisabled(false);
            }
        }

        // æ›´æ¢æµ‹è¯•å¤´åƒ
        function changeAvatar(type) {
            const avatarImg = document.getElementById('avatarImg');
            const avatars = {
                square: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face',
                wide: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=100&fit=crop&crop=face',
                tall: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&h=200&fit=crop&crop=face'
            };
            
            userData.avatar_url = avatars[type];
            avatarImg.src = avatars[type];
            showStatus(`å·²åˆ‡æ¢åˆ°${type === 'square' ? 'æ–¹å½¢' : type === 'wide' ? 'å®½å±' : 'é«˜å±'}å¤´åƒ`, 'success');
            setTimeout(hideStatus, 2000);
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('æ–°å¯¼å‡ºç³»ç»Ÿå·²å°±ç»ªï¼Œç‚¹å‡»å¯¼å‡ºæŒ‰é’®æµ‹è¯•ï¼', 'success');
            setTimeout(hideStatus, 4000);
        });
    </script>
</body>
</html>









