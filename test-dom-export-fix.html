<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOMå¯¼å‡ºåç§»ä¿®å¤æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/dom-to-image-more@3.1.0/dist/dom-to-image-more.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-card {
            width: 350px;
            height: 500px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            position: relative;
            margin: 20px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            border: 2px solid #ccc;
        }
        
        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #fff;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #333;
        }
        
        .name {
            text-align: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .title {
            text-align: center;
            color: white;
            font-size: 16px;
            margin: 10px 0;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .debug-info {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        
        .export-result {
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ DOMå¯¼å‡ºåç§»ä¿®å¤æµ‹è¯•</h1>
    
    <div class="export-result">
        <h3>æµ‹è¯•ç›®æ ‡ï¼šè§£å†³DOMå¯¼å‡ºçš„åç§»å’Œè¾¹æ¡†é—®é¢˜</h3>
        <p><strong>é—®é¢˜æè¿°ï¼š</strong>DOMå¯¼å‡ºçš„å›¾ç‰‡å‘å³åç§»ï¼Œå¹¶ä¸”æ·»åŠ äº†å¤šä½™çš„è¾¹æ¡†</p>
        <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong>ä½¿ç”¨ä¸´æ—¶å®¹å™¨ + æ ·å¼é‡ç½® + ç²¾ç¡®é…ç½®</p>
    </div>
    
    <!-- æµ‹è¯•åç‰‡ -->
    <div id="testCard" class="test-card">
        <div class="avatar">ğŸ‘¤</div>
        <div class="name">å¼ ä¸‰</div>
        <div class="title">é«˜çº§é¡¾é—®</div>
        <div style="text-align: center; color: white; margin-top: 50px;">
            <div>å·²æœåŠ¡å­¦å‘˜ï¼š500+</div>
            <div>å¥½è¯„ç‡ï¼š98%</div>
        </div>
    </div>
    
    <div class="controls">
        <button onclick="exportOriginalMethod()">ğŸ”´ åŸå§‹æ–¹æ³•ï¼ˆæœ‰é—®é¢˜ï¼‰</button>
        <button onclick="exportFixedMethod()">ğŸŸ¢ ä¿®å¤æ–¹æ³•ï¼ˆæ— åç§»ï¼‰</button>
        <button onclick="checkStyles()">ğŸ” æ£€æŸ¥æ ·å¼</button>
    </div>
    
    <div id="debugInfo" class="debug-info"></div>
    
    <script>
        const debugInfo = document.getElementById('debugInfo');
        
        function log(message) {
            debugInfo.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
        }
        
        // ğŸ”´ åŸå§‹æœ‰é—®é¢˜çš„å¯¼å‡ºæ–¹æ³•
        async function exportOriginalMethod() {
            log('å¼€å§‹åŸå§‹æ–¹æ³•å¯¼å‡º...');
            
            try {
                const element = document.getElementById('testCard');
                
                const dataUrl = await domtoimage.toPng(element, {
                    width: 350,
                    height: 500,
                    quality: 1.0,
                    bgcolor: '#ffffff'
                });
                
                downloadImage(dataUrl, 'original-method.png');
                log('âœ… åŸå§‹æ–¹æ³•å¯¼å‡ºå®Œæˆï¼ˆå¯èƒ½æœ‰åç§»ï¼‰');
                
            } catch (error) {
                log('âŒ åŸå§‹æ–¹æ³•å¯¼å‡ºå¤±è´¥: ' + error.message);
            }
        }
        
        // ğŸŸ¢ ä¿®å¤åçš„å¯¼å‡ºæ–¹æ³•
        async function exportFixedMethod() {
            log('å¼€å§‹ä¿®å¤æ–¹æ³•å¯¼å‡º...');
            
            try {
                const originalElement = document.getElementById('testCard');
                const width = 350;
                const height = 500;
                
                // åˆ›å»ºä¸´æ—¶å®¹å™¨
                const tempContainer = document.createElement('div');
                tempContainer.style.cssText = `
                    position: fixed !important;
                    top: -10000px !important;
                    left: -10000px !important;
                    width: ${width}px !important;
                    height: ${height}px !important;
                    margin: 0 !important;
                    padding: 0 !important;
                    border: none !important;
                    outline: none !important;
                    box-shadow: none !important;
                    background: transparent !important;
                    overflow: hidden !important;
                    box-sizing: border-box !important;
                    z-index: -9999 !important;
                `;
                
                // å…‹éš†å…ƒç´ 
                const clonedCard = originalElement.cloneNode(true);
                
                // é‡ç½®æ ·å¼
                clonedCard.style.cssText = `
                    position: relative !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: ${width}px !important;
                    height: ${height}px !important;
                    margin: 0 !important;
                    padding: 20px !important;
                    border: none !important;
                    outline: none !important;
                    box-shadow: none !important;
                    transform: none !important;
                    overflow: hidden !important;
                    box-sizing: border-box !important;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                    border-radius: 16px !important;
                `;
                
                // æ·±åº¦æ¸…ç†å­å…ƒç´ 
                const allElements = clonedCard.querySelectorAll('*');
                allElements.forEach(el => {
                    if (el.style) {
                        // ä¿ç•™å¿…è¦æ ·å¼ï¼Œç§»é™¤è¾¹è·è¾¹æ¡†
                        const essentialStyles = {
                            color: el.style.color || window.getComputedStyle(el).color,
                            fontSize: el.style.fontSize || window.getComputedStyle(el).fontSize,
                            fontWeight: el.style.fontWeight || window.getComputedStyle(el).fontWeight,
                            textAlign: el.style.textAlign || window.getComputedStyle(el).textAlign,
                            background: el.style.background || window.getComputedStyle(el).background,
                            borderRadius: el.style.borderRadius || window.getComputedStyle(el).borderRadius
                        };
                        
                        // é‡ç½®å¹¶é‡æ–°åº”ç”¨
                        el.style.margin = '0';
                        el.style.border = 'none';
                        el.style.boxShadow = 'none';
                        el.style.outline = 'none';
                        
                        Object.entries(essentialStyles).forEach(([prop, value]) => {
                            if (value && value !== 'none') {
                                el.style[prop] = value;
                            }
                        });
                    }
                });
                
                // æ·»åŠ åˆ°DOM
                tempContainer.appendChild(clonedCard);
                document.body.appendChild(tempContainer);
                
                log('å·²åˆ›å»ºä¸´æ—¶å®¹å™¨ï¼Œç­‰å¾…æ¸²æŸ“...');
                await new Promise(resolve => setTimeout(resolve, 200));
                
                // å¯¼å‡º
                const dataUrl = await domtoimage.toPng(clonedCard, {
                    width: width,
                    height: height,
                    quality: 1.0,
                    bgcolor: '#ffffff',
                    style: {
                        margin: '0',
                        padding: '0',
                        border: 'none'
                    }
                });
                
                // æ¸…ç†
                document.body.removeChild(tempContainer);
                
                downloadImage(dataUrl, 'fixed-method.png');
                log('âœ… ä¿®å¤æ–¹æ³•å¯¼å‡ºå®Œæˆï¼ˆæ— åç§»ï¼‰');
                
            } catch (error) {
                log('âŒ ä¿®å¤æ–¹æ³•å¯¼å‡ºå¤±è´¥: ' + error.message);
            }
        }
        
        // æ£€æŸ¥æ ·å¼
        function checkStyles() {
            const element = document.getElementById('testCard');
            const styles = window.getComputedStyle(element);
            
            const styleInfo = [
                `å°ºå¯¸: ${styles.width} x ${styles.height}`,
                `ä½ç½®: ${styles.position}`,
                `è¾¹è·: ${styles.margin}`,
                `å†…è¾¹è·: ${styles.padding}`,
                `è¾¹æ¡†: ${styles.border}`,
                `ç›’æ¨¡å‹: ${styles.boxSizing}`,
                `é˜´å½±: ${styles.boxShadow}`,
                `å˜æ¢: ${styles.transform}`
            ];
            
            log('å½“å‰å…ƒç´ æ ·å¼:\n' + styleInfo.join('\n'));
        }
        
        // ä¸‹è½½å›¾ç‰‡
        function downloadImage(dataUrl, filename) {
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = filename;
            link.click();
        }
        
        // åˆå§‹åŒ–
        log('DOMå¯¼å‡ºä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
        log('è¯·ç‚¹å‡»æŒ‰é’®æµ‹è¯•ä¸åŒçš„å¯¼å‡ºæ–¹æ³•');
    </script>
</body>
</html>
